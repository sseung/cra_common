<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>attendance2.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include &lt;string&gt;
#include &lt;vector&gt;
#include &lt;memory&gt;
#include &lt;map&gt;
#include &lt;algorithm&gt;
#include "gmock/gmock.h"
#include "../Mission2/attendance.h"

using namespace std;

<span style = "background-color:#dfd">int DefaultScorePolicy::calculateScore(const vector&lt;string&gt;&amp; attendance) const {
    int score = 0, wed = 0, weekend = 0;
    for (const auto&amp; day : attendance) {
        if (day == WEDNESDAY) { score += WEDNESDAY_SCORE; wed++; }
        else if (day == SATURDAY || day == SUNDAY) { score += WEEKEND_SCORE; weekend++; }
        else score += NORMAL_SCORE;
    }
    if (wed &gt;= WEDNESDAY_ATTENDANCE_COUNT_FOR_BONUS) score += BONUS_WEDNESDAY_SCORE;
    if (weekend &gt;= WEEKEND_ATTENDANCE_COUNT_FOR_BONUS) score += BONUS_WEEKEND_SCORE;
    return score;
}</span>

<span style = "background-color:#dfd">int DefaultGradePolicy::determineGrade(int score) const {
    if (score &gt;= GOLD_SCORE) return GOLD_GRADE;
    if (score &gt;= SILVER_SCORE) return SILVER_GRADE;
    return NORMAL_GRADE;
}</span>

AttendanceManager::AttendanceManager(unique_ptr&lt;IScorePolicy&gt; sp, unique_ptr&lt;IGradePolicy&gt; gp)
<span style = "background-color:#dfd">    : scorePolicy(move(sp)), gradePolicy(move(gp)) {}</span>

<span style = "background-color:#dfd">void AttendanceManager::addPlayer(const Player&amp; p) {
    players.push_back(p);
}</span>

<span style = "background-color:#dfd">void AttendanceManager::process() {
    for (auto&amp; p : players) {
        p.score = scorePolicy-&gt;calculateScore(p.attendance);
        p.grade = gradePolicy-&gt;determineGrade(p.score);
        p.eliminationCandidate = checkElimination(p);
    }
}</span>

<span style = "background-color:#dfd">const vector&lt;Player&gt;&amp; AttendanceManager::getPlayers() const {
    return players;
}</span>

<span style = "background-color:#dfd">bool AttendanceManager::checkElimination(const Player&amp; p) {
    if (p.grade != NORMAL_GRADE) return false;
    bool wed = false, weekend = false;
    for (const auto&amp; d : p.attendance) {
        if (d == WEDNESDAY) wed = true;
        if (d == SATURDAY || d == SUNDAY) weekend = true;
    }
    return !(wed || weekend);
}</span>

<span style = "background-color:#fdd">void createPlayerMap(std::map&lt;std::string, Player&gt;&amp; playerMap) {
    ifstream fin{ RESOURCE_FILE };
    int playerId = 1;
    for (int i = 0; i &lt; MAX_NUM_OF_RESOURCE_DATA; i++) {
        string name, day;
        fin &gt;&gt; name &gt;&gt; day;</span>

<span style = "background-color:#fdd">        if (playerMap.find(name) != playerMap.end()) {
            playerMap[name].attendance.push_back(day);
        }</span>
        else {
<span style = "background-color:#fdd">            playerMap[name] = Player(playerId++, name, { day });</span>
        }
<span style = "background-color:#fdd">    }
}</span>

<span style = "background-color:#dfd">void printResult(const vector&lt;Player&gt;&amp; players) {
    vector&lt;const Player*&gt; playerPtrs;
    for (const auto&amp; p : players) {
        playerPtrs.push_back(&amp;p);
    }</span>

<span style = "background-color:#dfd">    sort(playerPtrs.begin(), playerPtrs.end(), [](const Player* a, const Player* b) {
        return a-&gt;id &lt; b-&gt;id; 
        });</span>

<span style = "background-color:#dfd">    for (const auto* p : playerPtrs) {
        cout &lt;&lt; "NAME : " &lt;&lt; p-&gt;name &lt;&lt; ", ";
        cout &lt;&lt; "POINT : " &lt;&lt; p-&gt;score &lt;&lt; ", ";
        cout &lt;&lt; "GRADE : ";</span>

<span style = "background-color:#dfd">        if (p-&gt;grade == GOLD_GRADE) {</span>
<span style = "background-color:#fdd">            cout &lt;&lt; GOLD &lt;&lt; "\n";
        }</span>
<span style = "background-color:#dfd">        else if (p-&gt;grade == SILVER_GRADE) {</span>
<span style = "background-color:#fdd">            cout &lt;&lt; SILVER &lt;&lt; "\n";
        }</span>
        else {
<span style = "background-color:#dfd">            cout &lt;&lt; NORMAL &lt;&lt; "\n";</span>
        }
<span style = "background-color:#dfd">    }
}</span>

<span style = "background-color:#dfd">void printRemovedPlayer(const vector&lt;Player&gt;&amp; players) {
    std::cout &lt;&lt; "\n";
    std::cout &lt;&lt; "Removed player\n";
    std::cout &lt;&lt; "==============\n";
    for (auto&amp; p : players) {
        if (p.eliminationCandidate) {</span>
<span style = "background-color:#fdd">            std::cout &lt;&lt; p.name &lt;&lt; "\n";</span>
        }
<span style = "background-color:#dfd">    }
}</span>

<span style = "background-color:#dfd">int main() {</span>
#ifndef _DEBUG
    auto manager = AttendanceManager(
        make_unique&lt;DefaultScorePolicy&gt;(),
        make_unique&lt;DefaultGradePolicy&gt;()
    );

    map&lt;string, Player&gt; playerMap;
    createPlayerMap(playerMap);
    for (const auto&amp; pair : playerMap) {
        manager.addPlayer(pair.second);
    }
    manager.process();

    printResult(manager.getPlayers());
    printRemovedPlayer(manager.getPlayers());
#else
<span style = "background-color:#dfd">    ::testing::InitGoogleMock();
    return RUN_ALL_TESTS();</span>
#endif
<span style = "background-color:#dfd">}</span>

</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>